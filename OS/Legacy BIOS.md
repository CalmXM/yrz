# Legacy BIOS

***在解释BIOS之前，我们先来了解一下固件：***

> 固件指存放在EPROM（可擦写可编程只读存储器）/EEPROM（电可擦写可编程只读存储器）中的驱动程序，可以理解长固化在硬件上的控制软件。不只是主板上有固件，许多硬件——例如网卡，显卡都有，用于管控硬件。



***BIOS的释义***

> BIOS就是一个固件，只不过他不是针对某个硬件，而是对应着整个计算机系统。
>
> 它是计算机启动时运行的第一个软件。



下面是百度百科偷来的内容，帮助理解：

```
***主要程序***

中断例程
BIOS中中断例程即BIOS中断服务程序。它是微机系统软、硬件之间的一个可编程接口，用于程序软件功能与微机硬件实现的衔接。DOS/Windows操作系统对软盘、硬盘、光驱与键盘、显示器等外围设备的管理即建立在系统BIOS的基础上。程序员也可以通过 对INT 5、INT 13等中断的访问直接调用BIOS中断例程。
系统设置
微机部件配置情况是放在一块可读写的CMOS RAM芯片中的，不接市电或笔记本没有电池时，CMOS通过一块后备电池向CMOS供电以保持其中的信息。如果CMOS中关于微机的配置信息不正确，会导致不能开机、时间不准、零部件不能识别，并由此引发一系列的软硬件故障。在BIOS ROM芯片中装有一个程序称为“系统设置程序”，就是用来设置BIOS中的参数的，并将这些设置保存在COMS中。这个程序一般在开机时按下一个或一组键即可进入，它提供了良好的界面供用户使用。
上电自检
微机接通电源后，系统将有一个对内部各个设备进行检查的过程，这是由一个通常称之为POST(Power On Self Test，上电自检）的程序来完成的。这也是BIOS的一个功能。完整的POST自检将包括CPU、640K基本内存、1M以上的扩展内存、ROM、主板、 CMOS存贮器、串并口、显示卡、软硬盘子系统及键盘测试。自检中若发现问题，系统将给出提示信息或鸣笛警告。
自检程序
在完成POST自检后，ROM BIOS将按照系统CMOS设置中的启动顺序搜寻软硬盘驱动器及CDROM、网络服务器等有效的启动驱动器 ，读入操作系统引导记录，然后将系统控制权交给引导记录，由引导记录完成系统的启动。
```





```
从功能上看，BIOS分为三个部分：

自检及初始化
这部分负责启动电脑，具体有三个部分：
第一个部分是用于电脑刚接通电源时对硬件部分的检测，也叫做加电自检（Power On Self Test，简称POST），功能是检查电脑是否良好，通常完整的POST自检将包括对CPU，640K基本内存，1M以上的扩展内存，ROM，主板，CMOS存储器，串并口，显示卡，软硬盘子系统及键盘进行测试，一旦在自检中发现问题，系统将给出提示信息或鸣笛警告。自检中如发现有错误，将按两种情况处理：对于严重故障（致命性故障）则停机，此时由于各种初始化操作还没完成，不能给出任何提示或信号；对于非严重故障则给出提示或声音报警信号，等待用户处理。

第二个部分是初始化，包括创建中断向量、设置寄存器、对一些外部设备进行初始化和检测等，其中很重要的一部分是BIOS设置，主要是对硬件设置的一些参数，当电脑启动时会读取这些参数，并和实际硬件设置进行比较，如果不符合，会影响系统的启动。

第三个部分是引导程序，功能是引导DOS或其他操作系统。BIOS先从软盘或硬盘的开始扇区读取引导记录，如果没有找到，则会在显示器上显示没有引导设备，如果找到引导记录会把电脑的控制权转给引导记录，由引导记录把操作系统装入电脑，在电脑启动成功后，BIOS的这部分任务就完成了。



程序服务处理
程序服务处理程序主要是为应用程序和操作系统服务，这些服务主要与输入输出设备有关，例如读磁盘、文件输出到打印机等。为了完成这些操作，BIOS必须直接与计算机的I/O设备打交道，它通过端口发出命令，向各种外部设备传送数据以及从它们那儿接收数据，使程序能够脱离具体的硬件操作。

硬件中断处理
硬件中断处理则分别处理PC机硬件的需求，BIOS的服务功能是通过调用中断服务程序来实现的，这些服务分为很多组，每组有一个专门的中断。例如视频服务，中断号为10H；屏幕打印，中断号为05H；磁盘及串行口服务，中断14H等。每一组又根据具体功能细分为不同的服务号。应用程序需要使用哪些外设、进行什么操作只需要在程序中用相应的指令说明即可，无需直接控制。
（二）（三）两部分功能虽然是两个独立的内容，但在使用上密切相关。这两部分分别为软件和硬件服务，组合到一起，使计算机系统正常运行。

另外需注意：BIOS设置不当会直接损坏计算机的硬件，甚至烧毁主板，建议不熟悉者慎重修改设置。用户可以通过设置BIOS来改变各种不同的设置，比如onboard显卡的内存大小。用户手上所有的操作系统都是由BIOS转交给引导扇区，再由引导扇区转到各分区激活相应的操作系统。
```





## MBR

> MBR全称“Master Boo Record”，意为“主引导记录”，位于磁盘的0号柱面，0号磁头，1号扇区，占512个字节



***三个组成部分：***

- 引导程序      1-446字节
- 分区表           446-510字节
- 主引导记录签名    511-512字节



着重讲一下分区表，分区表总共占64个字节，一个主分区占16个字节，也就是说最多只能有4个主分区，下图为一个分区表项的内容：

![img](https://bkimg.cdn.bcebos.com/pic/d8f9d72a6059252dd42a1fd235d2143b5bb5c8ea1386?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U5Mg==,g_7,xp_5,yp_5/format,f_auto)









## 计算机的启动流程

当年按下电源键：

- 启动BIOS，开始硬件检测，检测系统是否有问题
- 初始化系统
- 根据CMOS中已设定好的开机启动顺序，到对应的存储设备中去
- 这时，计算机读取该设备的第一个扇区，也就是读取最前面的512个字节。如果这512个字节的最后两个字节是0x55和0xAA，表明这个设备可以用于启动；如果不是，表明设备不能用于启动，控制权于是被转交给"启动顺序"中的下一个设备。这最前面的512个字节，就叫做主引导记录（Master boot record，缩写为MBR）
- 通过其中分区表找到活动分区（即操作系统所在的分区），利用引导程序将操作系统加载到内存，并将控制权交给它













# UEFI





